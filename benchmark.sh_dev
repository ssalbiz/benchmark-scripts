#/bin/bash

if [ -n "$1" ]; then
  echo "Running benchmark: $1"
else
  echo "Usage: ./benchmark.sh [benchmark name]"
  exit

fi
. settings-base.sh_dev $1 

echo "LOOKING IN ${CLASSES_DIR}"

if [ ! -n "$MAIN_CLASS" ]; then
   ## if no main class is set use whichever one soot infers
   echo java -Xmx2048m -cp ${CLASSPATH} MyMain ${SOOT_OPTIONS} --d ${OUTPUT_DIR} -pp --cp ${CLASSPATH} --allow-phantom-refs --src-prec class $CLASS_LIST  | tee $OUTPUT_FILE 
   java -Xmx1800m -cp ${CLASSPATH} MyMain ${SOOT_OPTIONS} --d ${OUTPUT_DIR} -pp --cp ${CLASSPATH} --allow-phantom-refs --src-prec class $CLASS_LIST 2>&1| tee  -a $OUTPUT_FILE
   	echo "RETURNED: $?"
	echo "terminal output logged at $OUTPUT_FILE"
else
   ## cycle through given entry points one by one in order to maximize code coverage.
   for (( i = 0; i < ${#MAIN_CLASS[@]}; i++ )); do
	echo java -Xmx2048m -cp ${CLASSPATH} MyMain ${SOOT_OPTIONS} --d ${OUTPUT_DIR} -pp --cp ${CLASSPATH} --allow-phantom-refs --src-prec class $CLASS_LIST -main-class ${MAIN_CLASS[$i]} | tee $OUTPUT_FILE.$i 
	java -Xmx2048m -cp ${CLASSPATH} MyMain ${SOOT_OPTIONS} --d ${OUTPUT_DIR} -pp --cp ${CLASSPATH} --allow-phantom-refs --src-prec class $CLASS_LIST -main-class ${MAIN_CLASS[$i]} 2>&1 | tee -a $OUTPUT_FILE.$i
   	echo "RETURNED: $?"
   done
   echo "terminal output logged at $OUTPUT_FILE"
fi
